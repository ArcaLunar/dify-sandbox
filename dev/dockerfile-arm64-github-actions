FROM python:3.10-slim

COPY . /workdir

RUN apt-get update && apt-get install -y \
    pkg-config gcc libseccomp-dev wget \
    && rm -rf /var/lib/apt/lists/*

RUN wget https://go.dev/dl/go1.20.6.linux-arm64.tar.gz -O /opt/go1.20.6.linux-arm64.tar.gz \
    && tar zxf /opt/go1.20.6.linux-arm64.tar.gz -C /opt \
    && rm /opt/go1.20.6.linux-arm64.tar.gz \
    && ln -s /opt/go/bin/go /usr/local/bin/go

RUN cd /workdir && go mod tidy \
    && bash ./build/build_arm64.sh

RUN pip install httpx requests jinja2
